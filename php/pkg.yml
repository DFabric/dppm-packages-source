package: php
name: PHP
type: lib
license: PHP-3.01
url: https://secure.php.net/
docs: https://secure.php.net/docs.php
description: PHP is a popular general-purpose scripting language that is especially suited to web development.
info: pear is also included

features:
  contained: true

version:
  self:
    src: https://bitbucket.org/dfabric/packages/downloads/SHA512SUMS
  linux:
    arm64: (?<=php-static_).*(?=_linux_arm64)
    armhf: (?<=php-static_).*(?=_linux_armhf)
    x86-64: (?<=php-static_).*(?=_linux_x86-64)

tags:
  latest:
    src: https://bitbucket.org/dfabric/packages/downloads/SHA512SUMS
    regex: (?<=php-static_).*(?=_linux_arm64)

exec:
  start: lib/php/sbin/php-fpm --allow-to-run-as-root --fpm-config etc/php-fpm.conf --prefix .
  test: lib/php/sbin/php-fpm --test --allow-to-run-as-root --fpm-config etc/php-fpm.conf --prefix .
  reload: USR2

# Used in the php application, not in the library itself
tasks:
  add:
  - ini.del etc/php-fpm.conf global.include
  - ini.set etc/php-fpm.conf global.pid pid
  - ini.set etc/php-fpm.conf global.include etc/php-fpm.d/*.conf
  - ini.set etc/php-fpm.conf global.daemonize no
  - ini.set etc/php-fpm.d/www.conf www.listen\.allowed_clients [::1]
  - ini.set etc/php-fpm.d/www.conf www.group ${GROUP}
  - ini.set etc/php-fpm.d/www.conf www.user ${USER}
  - ini.set etc/php-fpm.d/www.conf www.listen socket
  - ini.set etc/php-fpm.d/www.conf www.catch_workers_output yes
